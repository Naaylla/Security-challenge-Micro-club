<!DOCTYPE html>
<html lang="en">
<head>
    <title>Create account</title>
    <link rel="stylesheet" href="CreateAccountStyle.css">
</head>

<body>
    

<div class="container">
    <div class="overlay"></div>
</div>

<div class="navbar">
    <nav>
        <a href="Login.html">Login</a>
        <a href="CreateAccount.html">Create Account</a>
        <a href="#help">Help</a>
        <a href="#categories">Categories</a>
        <a href="home.html">Home</a>
    </nav>
</div>

<div class="bloc">

    <div class="margin">
        <h3>Username:</h3>
        <input id="usernameInput" type="text" placeholder="Username!" >
    </div>

    <div class="margin">
        <h3>Email:</h3>
        <input id="emailInput" type="email" placeholder="Email ex: hello@gmail.com" >
    </div>

    <div class="margin">
        <h3>Password:</h3>
        <input id="passwordInput" type="password" placeholder="password" >
        <h4> NOTE: the password should be at least 8 characters (numbers included) </h4>
    </div>

    <div class="margin">
        <h3>Confirm Password:</h3>
        <input id="confirmPasswordInput" type="password" placeholder="confirm password">
    </div>
    <div id="errorText" style="color: red; display: none; font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; margin-top: 5px;">Confirm password does not match!</div>
     
    
    <button id="createAccountButton" class="but">Create account</button>

    

</div>



<script>
document.getElementById('createAccountButton').addEventListener('click', function(event) {
    event.preventDefault();
    var usernameInput = document.getElementById('usernameInput');
    var emailInput = document.getElementById('emailInput');
    var passwordInput = document.getElementById('passwordInput');
    var confirmPasswordInput = document.getElementById('confirmPasswordInput');
    var createAccountButton = document.getElementById('createAccountButton');
    var errorText = document.getElementById('errorText');
    var usernameValue = usernameInput.value.trim();
    var emailValue = emailInput.value.trim();
    var passwordValue = passwordInput.value.trim();
    var confirmPasswordValue = confirmPasswordInput.value.trim();
    if (usernameValue !== '' && emailValue !== '' && passwordValue !== '' && confirmPasswordValue !== '') {
        if (passwordValue === confirmPasswordValue) {
            console.log('password matches');
            errorText.style.display = 'none';
            fetch('http://127.0.0.1:1880/register', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({
        username: usernameValue,
        email: emailValue,
        password: passwordValue,
    }),
})
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
        alert('Account created successfully!');
        // Assuming msg is the format expected by your Node-RED flow
        node.send({ payload: { username: usernameValue, email: emailValue, password: passwordValue } });
    })
    .catch(error => console.log('Error:', error));

        } else {
           console.log('password does not match');
              errorText.style.display = 'block';
        }
    } else {
        console.log('empty fields');
        errorText.style.display = 'block';
    }
});
</script>
</body>
</html>